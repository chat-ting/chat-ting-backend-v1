<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WebSocket Chat Test</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h1>WebSocket Chat Test</h1>
<textarea id="log" cols="100" rows="10" readonly></textarea><br/>
<input id="msg" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ìž…ë ¥í•˜ì„¸ìš”">
<button onclick="sendMessage()">ë³´ë‚´ê¸°</button>

<script>
    const log = document.getElementById("log");

    // âœ… í…ŒìŠ¤íŠ¸ìš© JWT í† í°
    const token = "test-jwt-token";

    // âœ… ì‹¤ì‚¬ìš© ì±„íŒ…ë°© UUID
    const roomId = "1f017e2b-ecb6-6e7b-b885-d7a80785ef4d";

    // âœ… WebSocket ì—°ê²° with í† í°
    const socket = new SockJS("http://localhost:8080/ws?token=" + token);
    const stompClient = Stomp.over(socket);

    stompClient.connect({}, () => {
        log.value += "âœ… Connected!\n";

        // âœ… ì±„íŒ…ë°© êµ¬ë…
        stompClient.subscribe("/topic/chat/" + roomId, message => {
            const msg = JSON.parse(message.body);
            log.value += `ðŸ“¥ ${msg.username}: ${msg.content}\n`;
        });
    });

    // âœ… ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
    function sendMessage() {
        const input = document.getElementById("msg");
        const content = input.value;
        if (!content) return;

        stompClient.send("/chat/send", {}, JSON.stringify({
            roomId: roomId,
            content: content
        }));

        input.value = '';
    }
</script>
</body>
</html>
